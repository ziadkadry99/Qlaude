"use strict";var w=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var F=(a,i)=>{for(var t in i)w(a,t,{get:i[t],enumerable:!0})},O=(a,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of R(i))!M.call(a,s)&&s!==t&&w(a,s,{get:()=>i[s],enumerable:!(e=_(i,s))||e.enumerable});return a};var A=a=>O(w({},"__esModule",{value:!0}),a);var N={};F(N,{default:()=>S});module.exports=A(N);var k=require("obsidian");var h=require("obsidian"),q={claudeBinaryPath:"claude",model:"claude-haiku-4-5",clearChatOnStart:!1,permissions:{readVault:!1,listVaultStructure:!1,editCurrentFile:!1,editAnyFile:!1,createFiles:!1}};function B(a){let i=["Read"];return a.permissions.listVaultStructure&&i.push("Glob","Grep","LS"),(a.permissions.editCurrentFile||a.permissions.editAnyFile)&&i.push("Edit"),(a.permissions.editAnyFile||a.permissions.createFiles)&&i.push("Write"),i}function D(a,i){let t=[];return t.push("## Permissions"),t.push(""),t.push("You have the following permissions in this vault:"),t.push(""),a.permissions.readVault?t.push("- Read files: YES (any file in the vault)"):i?t.push(`- Read files: RESTRICTED \u2014 you may only read the currently active file: ${i}`):t.push("- Read files: RESTRICTED \u2014 no file is currently active, you may not read any files"),a.permissions.listVaultStructure?t.push("- List vault structure (Glob, Grep, LS): YES"):t.push("- List vault structure (Glob, Grep, LS): NO"),a.permissions.editAnyFile?t.push("- Edit any file: YES"):a.permissions.editCurrentFile?i?t.push(`- Edit files: RESTRICTED \u2014 you may only edit the currently active file: ${i}`):t.push("- Edit files: RESTRICTED \u2014 no file is currently active"):t.push("- Edit files: NO"),a.permissions.createFiles?t.push("- Create new files: YES"):t.push("- Create new files: NO"),t.push(""),t.push("Strictly respect these permissions. Do not attempt actions outside what is permitted above."),t.join(`
`)}var b=class extends h.PluginSettingTab{constructor(i,t){super(i,t),this.plugin=t}display(){let{containerEl:i}=this;i.empty(),new h.Setting(i).setName("Claude binary path").setDesc("Full path to the Claude CLI binary, or just `claude` if it is on your PATH.").addText(t=>t.setValue(this.plugin.settings.claudeBinaryPath).onChange(async e=>{this.plugin.settings.claudeBinaryPath=e.trim()||"claude",await this.plugin.saveSettings()})),new h.Setting(i).setName("Model").setDesc("Claude model ID to use for all requests. Any model supported by the CLI can be entered here.").addText(t=>t.setValue(this.plugin.settings.model).onChange(async e=>{this.plugin.settings.model=e.trim()||"claude-haiku-4-5",await this.plugin.saveSettings()})),new h.Setting(i).setName("Clear chat on start").setDesc("Automatically clear the chat history and session when Obsidian starts.").addToggle(t=>t.setValue(this.plugin.settings.clearChatOnStart).onChange(async e=>{this.plugin.settings.clearChatOnStart=e,await this.plugin.saveSettings()})),new h.Setting(i).setName("Permissions").setHeading(),i.createEl("p",{text:"Control what Claude is allowed to do inside your vault \u2014 by default, Claude can only read the currently active file.",cls:"setting-item-description"}),new h.Setting(i).setName("Read entire vault").setDesc("Read any file in the vault, not just the currently active file.").addToggle(t=>t.setValue(this.plugin.settings.permissions.readVault).onChange(async e=>{this.plugin.settings.permissions.readVault=e,await this.plugin.saveSettings()})),new h.Setting(i).setName("List vault structure").setDesc("Search and list files in your vault using glob, grep, and ls.").addToggle(t=>t.setValue(this.plugin.settings.permissions.listVaultStructure).onChange(async e=>{this.plugin.settings.permissions.listVaultStructure=e,await this.plugin.saveSettings()})),new h.Setting(i).setName("Edit current file").setDesc("Edit the currently active file.").addToggle(t=>t.setValue(this.plugin.settings.permissions.editCurrentFile).onChange(async e=>{this.plugin.settings.permissions.editCurrentFile=e,e?await this.plugin.saveSettings():(this.plugin.settings.permissions.editAnyFile=!1,await this.plugin.saveSettings(),this.display())})),new h.Setting(i).setName("Edit any file").setDesc("Edit any file in the vault (also enables edit current file).").addToggle(t=>t.setValue(this.plugin.settings.permissions.editAnyFile).onChange(async e=>{this.plugin.settings.permissions.editAnyFile=e,e&&(this.plugin.settings.permissions.editCurrentFile=!0),await this.plugin.saveSettings(),this.display()})),new h.Setting(i).setName("Create files").setDesc("Create new files in the vault.").addToggle(t=>t.setValue(this.plugin.settings.permissions.createFiles).onChange(async e=>{this.plugin.settings.permissions.createFiles=e,await this.plugin.saveSettings()}))}};var T=require("obsidian");var L=require("child_process");function U(a,i,t,e){let s=[];return s.push("You are Claude Code running inside Obsidian, a note-taking application."),s.push(""),s.push("## Vault Context"),s.push(""),s.push(`Vault root: ${a}`),i?s.push(`Currently active file: ${i}`):s.push("Currently active file: (none)"),s.push(""),s.push("## File Path Guidelines"),s.push(""),s.push('- All file paths should be relative to the vault root (e.g., "Notes/foo.md", not absolute paths)'),s.push("- Obsidian notes use the Markdown format (.md extension)"),s.push("- Internal links between notes use [[wikilink]] syntax (double square brackets)"),s.push("- Tags in Obsidian start with # (e.g., #project, #todo)"),s.push("- YAML frontmatter at the top of a file (between --- delimiters) stores note metadata"),s.push(""),s.push(D(t,i)),e&&(s.push(""),s.push("## Mode"),s.push(""),s.push('You are operating in quick-action mode. The user cannot send follow-up messages \u2014 this is a single-shot request. If the request involves making changes to files, carry out those changes directly without asking for confirmation. Do not say "Should I proceed?" or "Would you like me to...?" \u2014 just do it. If a request is genuinely ambiguous and you cannot act without more information, state your assumption briefly and act on it.')),s.join(`
`)}function I(a,i){var s,n,r,l,m;if(!a.trim())return;let t;try{t=JSON.parse(a)}catch(u){return}let e=t.type;if(e==="system"){if(t.subtype==="init"){let o=t.session_id,p=(n=(s=t.tools)==null?void 0:s.map(d=>d.name))!=null?n:[];i.onSystemInit(o,p)}return}if(e==="assistant"){let u=t.message;if(!(u!=null&&u.content))return;for(let o of u.content){let p=o.type;if(p==="text"){let d=o.text;d&&i.onText(d)}else p==="tool_use"&&i.onToolUse({id:o.id,name:o.name,input:(r=o.input)!=null?r:{}})}return}if(e==="user"){let u=t.message;if(!(u!=null&&u.content))return;for(let o of u.content)if(o.type==="tool_result"){let d=o.content,g;typeof d=="string"?g=d:Array.isArray(d)?g=d.map(f=>{var E;return(E=f.text)!=null?E:""}).join(`
`):g=JSON.stringify(d),i.onToolResult({tool_use_id:o.tool_use_id,content:g})}return}if(e==="result"){let u=t.subtype;if(u==="success"){let o=(l=t.num_turns)!=null?l:0,p=(m=t.cost_usd)!=null?m:0;i.onDone(o,p)}else if(u==="error"){let o=t.error;i.onError(o!=null?o:"Unknown error from Claude")}return}}function y(a){var f,E;let{prompt:i,vaultPath:t,currentFilePath:e,settings:s,callbacks:n,sessionId:r,quickAction:l}=a,m=B(s),u=U(t,e,s,l),o=["-p",i,"--output-format","stream-json","--verbose","--model",s.model,"--system-prompt",u,"--allowedTools",m.join(","),"--dangerously-skip-permissions"];r&&o.push("--resume",r);let p={...process.env};delete p.CLAUDECODE,delete p.CLAUDE_CODE;let d;try{d=(0,L.spawn)(s.claudeBinaryPath,o,{cwd:t,env:p,stdio:["ignore","pipe","pipe"]})}catch(c){let v=c;return v.code==="ENOENT"?n.onError(`Claude binary not found at "${s.claudeBinaryPath}". Please check the binary path in Claudian settings.`):n.onError(`Failed to start Claude: ${v.message}`),{kill:()=>{}}}let g="";return(f=d.stdout)==null||f.on("data",c=>{var C;g+=c.toString("utf8");let v=g.split(`
`);g=(C=v.pop())!=null?C:"";for(let P of v)I(P,n)}),(E=d.stderr)==null||E.on("data",c=>{let v=c.toString("utf8").trim(),C=v.toLowerCase();(C.includes("error")||C.includes("failed"))&&n.onError(v)}),d.on("error",c=>{c.code==="ENOENT"?n.onError(`Claude binary not found at "${s.claudeBinaryPath}". Please check the binary path in Claudian settings.`):n.onError(`Process error: ${c.message}`)}),d.on("close",c=>{g.trim()&&I(g,n)}),{kill:()=>{try{d.kill("SIGTERM")}catch(c){}}}}var x=class extends T.Modal{constructor(t,e,s,n,r){super(t);this.mode="quick";this.runner=null;this.quickSessionId=null;this.hadWrites=!1;this.status="idle";this.toolCards=new Map;this.turns=0;this.costUsd=0;this.currentTextBlock=null;this.currentTextContent="";this.currentTurnMarkdown="";this.persistedTurns=[];this.currentTurnClaudeEl=null;this.sessionId=null;this.loadingIndicatorEl=null;this.settings=e,this.vaultPath=s,this.currentFilePath=n,this.storage=r}onOpen(){let{contentEl:t}=this;t.addClass("qlaude-modal"),this.modalEl.addClass("qlaude-modal-outer");let e=t.createDiv("qlaude-header");e.createEl("h2",{text:"Qlaude",cls:"qlaude-title"}),this.currentFilePath?e.createEl("span",{text:`Active file: ${this.currentFilePath}`,cls:"qlaude-active-file"}):e.createEl("span",{text:"No active file",cls:"qlaude-active-file qlaude-active-file--none"});let s=e.createDiv("qlaude-mode-tabs");this.quickTabBtn=s.createEl("button",{text:"Quick action",cls:"qlaude-mode-tab qlaude-mode-tab--active"}),this.quickTabBtn.addEventListener("click",()=>this.switchMode("quick")),this.chatTabBtn=s.createEl("button",{text:"Chat",cls:"qlaude-mode-tab"}),this.chatTabBtn.addEventListener("click",()=>this.switchMode("chat"));let n=t.createDiv("qlaude-prompt-area");this.promptTextarea=n.createEl("textarea",{cls:"qlaude-textarea",attr:{placeholder:"What should Claude do? (Ctrl+Enter to run)",rows:"3"}}),this.promptTextarea.addEventListener("keydown",l=>{(l.ctrlKey||l.metaKey)&&l.key==="Enter"&&(l.preventDefault(),this.handleRun()),l.key==="Escape"&&this.handleCancel()});let r=t.createDiv("qlaude-buttons");this.clearBtn=r.createEl("button",{text:"Clear",cls:"qlaude-btn qlaude-btn--clear"}),this.clearBtn.addEventListener("click",()=>this.handleClear()),this.undoBtn=r.createEl("button",{text:"Undo",cls:"qlaude-btn qlaude-btn--undo"}),this.undoBtn.addEventListener("click",()=>this.handleUndo()),this.cancelBtn=r.createEl("button",{text:"Cancel",cls:"qlaude-btn qlaude-btn--cancel"}),this.cancelBtn.addEventListener("click",()=>this.handleCancel()),this.runBtn=r.createEl("button",{text:"Run",cls:"qlaude-btn qlaude-btn--run"}),this.runBtn.addEventListener("click",()=>this.handleRun()),t.createEl("hr",{cls:"qlaude-divider"}),this.outputEl=t.createDiv("qlaude-output"),this.conversationEl=this.outputEl.createDiv("qlaude-conversation"),this.statusEl=t.createDiv("qlaude-status"),setTimeout(()=>this.promptTextarea.focus(),50)}onClose(){this.runner&&(this.runner.kill(),this.runner=null);let{contentEl:t}=this;t.empty()}get activeOutputEl(){return this.mode==="chat"&&this.currentTurnClaudeEl?this.currentTurnClaudeEl:this.outputEl}handleRun(){if(this.status==="running")return;let t=this.promptTextarea.value.trim();t&&(this.mode==="chat"?this.runChat(t):this.runQuick(t))}runQuick(t){this.hideLoadingIndicator(),this.undoBtn.removeClass("is-visible"),this.outputEl.empty(),this.conversationEl=this.outputEl.createDiv("qlaude-conversation"),this.toolCards.clear(),this.currentTextBlock=null,this.currentTextContent="",this.turns=0,this.costUsd=0,this.quickSessionId=null,this.hadWrites=!1,this.setStatus("running"),this.showLoadingIndicator(),this.runner=y({prompt:t,vaultPath:this.vaultPath,currentFilePath:this.currentFilePath,settings:this.settings,quickAction:!0,callbacks:{onText:e=>this.handleText(e),onToolUse:e=>{(e.name==="Edit"||e.name==="Write")&&(this.hadWrites=!0),this.handleToolUse(e)},onToolResult:e=>this.handleToolResult(e),onSystemInit:(e,s)=>{this.quickSessionId=e},onDone:(e,s)=>{this.turns=e,this.costUsd=s,this.hideLoadingIndicator(),this.promptTextarea.disabled=!0,this.hadWrites&&this.quickSessionId&&this.undoBtn.addClass("is-visible"),this.setStatus("done")},onError:e=>{this.appendError(e),this.hideLoadingIndicator(),this.promptTextarea.disabled=!0,this.setStatus("error")}}})}runChat(t){let e=this.sessionId;this.toolCards.clear(),this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="";let s=this.conversationEl.createDiv("qlaude-turn");s.createDiv("qlaude-turn__user").textContent=t,this.currentTurnClaudeEl=s.createDiv("qlaude-turn__claude"),this.promptTextarea.value="",this.setStatus("running"),this.showLoadingIndicator(),this.scrollOutputToBottom(),this.runner=y({prompt:t,vaultPath:this.vaultPath,currentFilePath:this.currentFilePath,settings:this.settings,sessionId:e!=null?e:void 0,callbacks:{onText:n=>this.handleText(n),onToolUse:n=>this.handleToolUse(n),onToolResult:n=>this.handleToolResult(n),onSystemInit:(n,r)=>{this.sessionId=n},onDone:(n,r)=>{this.turns=n,this.costUsd=r,this.hideLoadingIndicator(),this.persistedTurns.push({userText:t,claudeMarkdown:this.currentTurnMarkdown}),this.storage.save(this.sessionId,this.persistedTurns),this.currentTurnClaudeEl=null,this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="",this.setStatus("done"),this.promptTextarea.disabled=!1,this.promptTextarea.focus()},onError:n=>{this.appendError(n),this.hideLoadingIndicator(),this.currentTurnClaudeEl=null,this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="",this.setStatus("error"),this.promptTextarea.disabled=!1}}})}switchMode(t){t!==this.mode&&(this.runner&&(this.runner.kill(),this.runner=null),this.hideLoadingIndicator(),this.undoBtn.removeClass("is-visible"),this.mode=t,this.currentTurnClaudeEl=null,this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="",this.toolCards.clear(),this.quickSessionId=null,this.hadWrites=!1,this.promptTextarea.disabled=!1,this.setStatus("idle"),t==="quick"?(this.quickTabBtn.addClass("qlaude-mode-tab--active"),this.chatTabBtn.removeClass("qlaude-mode-tab--active"),this.sessionId=null,this.persistedTurns=[],this.outputEl.empty(),this.conversationEl=this.outputEl.createDiv("qlaude-conversation"),this.clearBtn.removeClass("is-visible"),this.modalEl.removeClass("qlaude-modal--chat"),this.promptTextarea.setAttribute("placeholder","What should Claude do? (Ctrl+Enter to run)")):(this.chatTabBtn.addClass("qlaude-mode-tab--active"),this.quickTabBtn.removeClass("qlaude-mode-tab--active"),this.outputEl.empty(),this.conversationEl=this.outputEl.createDiv("qlaude-conversation"),this.conversationEl.addClass("is-visible"),this.clearBtn.addClass("is-visible"),this.modalEl.addClass("qlaude-modal--chat"),this.promptTextarea.setAttribute("placeholder","Message Claude... (Ctrl+Enter to send)"),this.restoreConversation()),this.promptTextarea.focus())}async restoreConversation(){var s;let{sessionId:t,turns:e}=await this.storage.load();this.sessionId=t,this.persistedTurns=[...e];for(let n of e){let r=this.conversationEl.createDiv("qlaude-turn");r.createDiv("qlaude-turn__user").textContent=n.userText;let l=r.createDiv("qlaude-turn__claude");n.claudeMarkdown&&await T.MarkdownRenderer.render(this.app,n.claudeMarkdown,l,(s=this.currentFilePath)!=null?s:"",this)}this.scrollOutputToBottom()}handleClear(){this.runner&&(this.runner.kill(),this.runner=null),this.hideLoadingIndicator(),this.conversationEl.empty(),this.sessionId=null,this.persistedTurns=[],this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="",this.currentTurnClaudeEl=null,this.toolCards.clear(),this.promptTextarea.disabled=!1,this.storage.clear(),this.setStatus("idle")}handleUndo(){let t=this.quickSessionId;t&&(this.undoBtn.removeClass("is-visible"),this.quickSessionId=null,this.hadWrites=!1,this.hideLoadingIndicator(),this.outputEl.empty(),this.conversationEl=this.outputEl.createDiv("qlaude-conversation"),this.toolCards.clear(),this.currentTextBlock=null,this.currentTextContent="",this.turns=0,this.costUsd=0,this.setStatus("running"),this.showLoadingIndicator(),this.runner=y({prompt:"Undo the changes you just made.",vaultPath:this.vaultPath,currentFilePath:this.currentFilePath,settings:this.settings,sessionId:t,callbacks:{onText:e=>this.handleText(e),onToolUse:e=>this.handleToolUse(e),onToolResult:e=>this.handleToolResult(e),onSystemInit:(e,s)=>{},onDone:(e,s)=>{this.turns=e,this.costUsd=s,this.hideLoadingIndicator(),this.promptTextarea.disabled=!0,this.setStatus("done")},onError:e=>{this.appendError(e),this.hideLoadingIndicator(),this.promptTextarea.disabled=!0,this.setStatus("error")}}}))}handleCancel(){this.status==="running"&&this.runner?(this.runner.kill(),this.runner=null,this.hideLoadingIndicator(),this.mode==="chat"&&(this.currentTurnClaudeEl=null,this.currentTextBlock=null,this.currentTextContent="",this.currentTurnMarkdown="",this.promptTextarea.disabled=!1),this.setStatus("cancelled")):this.close()}handleText(t){var e;this.currentTextBlock||(this.currentTextBlock=this.activeOutputEl.createDiv("qlaude-text-block"),this.currentTextContent=""),this.currentTextContent+=t,this.currentTurnMarkdown+=t,this.currentTextBlock.empty(),T.MarkdownRenderer.render(this.app,this.currentTextContent,this.currentTextBlock,(e=this.currentFilePath)!=null?e:"",this),this.bumpLoadingIndicator(),this.scrollOutputToBottom()}handleToolUse(t){this.currentTurnMarkdown&&!this.currentTurnMarkdown.endsWith(`

`)&&(this.currentTurnMarkdown+=`

`),this.currentTextBlock=null,this.currentTextContent="";let e=this.activeOutputEl.createDiv("qlaude-tool-card"),s=e.createDiv("qlaude-tool-card__header"),n=s.createSpan({text:"\u25B6",cls:"qlaude-tool-card__toggle"});s.createSpan({text:t.name,cls:"qlaude-tool-card__name"});let r=this.summarizeToolInput(t.name,t.input);s.createSpan({text:r,cls:"qlaude-tool-card__summary"});let l=e.createDiv("qlaude-tool-card__body"),m=l.createEl("pre",{cls:"qlaude-tool-card__input"});m.textContent=JSON.stringify(t.input,null,2);let u=l.createDiv("qlaude-tool-card__result");u.textContent="Waiting for result...";let o={toolUse:t,cardEl:e,headerEl:s,bodyEl:l,resultEl:u,isExpanded:!1};this.toolCards.set(t.id,o),s.addEventListener("click",()=>{o.isExpanded=!o.isExpanded,l.toggleClass("is-expanded",o.isExpanded),n.textContent=o.isExpanded?"\u25BC":"\u25B6"}),this.bumpLoadingIndicator(),this.scrollOutputToBottom()}handleToolResult(t){let e=this.toolCards.get(t.tool_use_id);e&&(e.cardEl.remove(),this.toolCards.delete(t.tool_use_id))}appendError(t){this.currentTextBlock=null,this.currentTextContent="";let e=this.activeOutputEl.createDiv("qlaude-error-block");e.textContent=t,this.bumpLoadingIndicator(),this.scrollOutputToBottom()}showLoadingIndicator(){let t=this.mode==="chat"&&this.currentTurnClaudeEl?this.currentTurnClaudeEl:this.outputEl;this.loadingIndicatorEl=t.createDiv("qlaude-loading"),this.loadingIndicatorEl.createSpan({cls:"qlaude-loading__dot"}),this.loadingIndicatorEl.createSpan({cls:"qlaude-loading__dot"}),this.loadingIndicatorEl.createSpan({cls:"qlaude-loading__dot"}),this.scrollOutputToBottom()}hideLoadingIndicator(){this.loadingIndicatorEl&&(this.loadingIndicatorEl.remove(),this.loadingIndicatorEl=null)}bumpLoadingIndicator(){var t;(t=this.loadingIndicatorEl)!=null&&t.parentElement&&this.loadingIndicatorEl.parentElement.appendChild(this.loadingIndicatorEl)}setStatus(t){switch(this.status=t,this.statusEl.addClass("is-visible"),this.statusEl.className="qlaude-status is-visible",t){case"running":this.statusEl.addClass("qlaude-status--running"),this.statusEl.textContent="Running...",this.runBtn.disabled=!0,this.cancelBtn.textContent="Stop";break;case"done":this.statusEl.addClass("qlaude-status--done"),this.statusEl.textContent="Done",this.runBtn.disabled=!1,this.cancelBtn.textContent=this.mode==="chat"?"Cancel":"Close";break;case"error":this.statusEl.addClass("qlaude-status--error"),this.statusEl.textContent="Error occurred. See output above.",this.runBtn.disabled=!1,this.cancelBtn.textContent=this.mode==="chat"?"Cancel":"Close";break;case"cancelled":this.statusEl.addClass("qlaude-status--cancelled"),this.statusEl.textContent="Cancelled.",this.runBtn.disabled=!1,this.cancelBtn.textContent=this.mode==="chat"?"Cancel":"Close";break;case"idle":this.statusEl.removeClass("is-visible"),this.runBtn.disabled=!1,this.cancelBtn.textContent="Cancel";break}}summarizeToolInput(t,e){let s=n=>typeof n=="string"?n:"";switch(t){case"Read":case"Edit":case"Write":return s(e.file_path);case"Glob":case"Grep":return s(e.pattern);case"LS":return s(e.path)||".";default:return Object.keys(e).slice(0,2).join(", ")}}scrollOutputToBottom(){this.outputEl.scrollTop=this.outputEl.scrollHeight}};var S=class extends k.Plugin{async onload(){var i;if(await this.loadSettings(),this.settings.clearChatOnStart){let t=(i=await this.loadData())!=null?i:{};delete t._chat,await this.saveData(t)}this.addSettingTab(new b(this.app,this)),this.addCommand({id:"open-claudian-modal",name:"Open",callback:()=>this.openModal()}),this.addRibbonIcon("bot","Open",()=>this.openModal())}async loadSettings(){var t;let i=(t=await this.loadData())!=null?t:{};this.settings=Object.assign({},q,i),this.settings.permissions=Object.assign({},q.permissions,this.settings.permissions)}async saveSettings(){var t;let i=(t=await this.loadData())!=null?t:{};await this.saveData({...i,...this.settings})}openModal(){let i=this.getVaultPath();if(!i){console.error("Claudian: Could not determine vault path");return}let t=this.app.workspace.getActiveFile(),e=t instanceof k.TFile?t.path:null,s={load:async()=>{var r,l;return(l=((r=await this.loadData())!=null?r:{})._chat)!=null?l:{sessionId:null,turns:[]}},save:async(n,r)=>{var m;let l=(m=await this.loadData())!=null?m:{};l._chat={sessionId:n,turns:r},await this.saveData(l)},clear:async()=>{var r;let n=(r=await this.loadData())!=null?r:{};delete n._chat,await this.saveData(n)}};new x(this.app,this.settings,i,e,s).open()}getVaultPath(){let i=this.app.vault.adapter;return typeof i.getBasePath=="function"?i.getBasePath():null}};
